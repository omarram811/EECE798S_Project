<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Course TA Agent Studio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .btn-custom {
      background-color: #840032;
      color: white;
      padding: 0.6rem 1.2rem;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    .btn-custom:hover {
      background-color: #a5004c;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">

  <!-- Header with logo -->
  <header class="flex justify-between items-center p-6 bg-white shadow-md">
    <h1 class="text-3xl font-bold text-gray-800">Dashboard</h1>
    <div class="flex items-center gap-6">
      <!-- Logout button styled same as authorize -->
      <a href="/logout" class="btn-custom px-4 py-2 text-sm">Logout</a>
      <img src="/static/logos.png" alt="Logo" class="h-20 w-auto">
    </div>
  </header>


  <main class="max-w-6xl mx-auto p-6 space-y-8">

    <!-- Google Drive connection -->
    <div class="bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-xl font-semibold mb-3">Connect Google Drive</h2>
      {% if google_connected %}
        <p class="text-green-700 font-medium">Connected. You can add Drive folders to your agents.</p>
      {% else %}
        <a class="btn-custom" href="/google/auth">Authorize Drive</a>
      {% endif %}
    </div>

    <div class="grid md:grid-cols-2 gap-8 items-start">

      <!-- Create TA Agent Form -->
      <form action="/agents/create" method="post" class="bg-white p-6 rounded-xl shadow-md space-y-4">
        <h2 class="text-xl font-semibold">Create a TA Agent</h2>

        <div>
          <label class="text-sm font-medium">Model Name</label>
          <input class="border rounded p-3 w-full text-lg" placeholder="e.g. EECE 490 TA" name="name" required />
        </div>

        <div>
          <label class="text-sm font-medium">Google Drive Folder URL or ID</label>
          <input class="border rounded p-3 w-full text-lg" placeholder="https://drive.google.com/drive/folders/..." name="drive_folder"/>
        </div>

        <div>
          <label class="text-sm font-medium">Persona / Description</label>
          <textarea class="border rounded p-3 w-full text-lg" name="persona" placeholder="You are a helpful teaching assistant for this course...">You are a helpful teaching assistant for this course. You have access to course materials and can help students understand concepts, answer questions, and guide them through assignments. Be encouraging, clear, and always cite sources from the course materials when possible.</textarea>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-medium">Provider</label>
            <select class="border rounded p-3 w-full text-lg" name="provider">
              <option value="openai">OpenAI</option>
              <option value="gemini">Gemini</option>
            </select>
          </div>
          <div>
            <label class="text-sm font-medium">Chat Model</label>
            <input class="border rounded p-3 w-full text-lg" name="model" placeholder="gpt-4o-mini or gemini-2.0-flash"/>
          </div>
        </div>

        <div>
          <label class="text-sm font-medium">Embedding Model</label>
          <input class="border rounded p-3 w-full text-lg" name="embed_model" value="openai:text-embedding-3-small" />
        </div>

        <button type="submit" class="btn-custom w-full text-lg">Create Agent</button>
      </form>

      <!-- Your Agents List -->
      <div class="bg-white p-6 rounded-xl shadow-md space-y-4">
        <h2 class="text-xl font-semibold">Your Agents</h2>
        <ul class="space-y-3">
          {% for a in agents %}
          <li class="relative border rounded-xl p-4 pr-10">

            <!-- DELETE BUTTON (opens modal) -->
            <button onclick="openDeleteModal('{{ a.id }}')"
                    class="absolute top-2 right-2 text-gray-500 hover:text-red-600 text-lg font-bold">
                Ã—
            </button>

            <div class="flex justify-between items-center">
                <div>
                    <div class="font-medium text-gray-800">{{ a.name }}</div>
                    <div class="text-xs text-gray-500">
                        Provider: {{ a.provider }} | Model: {{ a.model }}
                    </div>
                </div>

                <div class="flex gap-2 mr-4">
                    <a class="btn-custom px-4 py-2 text-sm" href="/a/{{ a.slug }}">Open</a>
                    <a class="px-4 py-2 text-sm bg-gray-700 text-white rounded hover:bg-gray-800"
                      href="/agents/{{ a.id }}/logs">View Logs</a>
                </div>
            </div>

        </li>


          {% else %}
          <li class="text-gray-500">No agents yet.</li>
          {% endfor %}
        </ul>
      </div>

    </div>
  </main>
<!-- DELETE CONFIRMATION MODAL -->
<div id="deleteModal"
     class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden">
    
    <div class="bg-white rounded-xl shadow-lg p-6 w-80">
        <h3 class="text-lg font-semibold mb-4 text-gray-800">Delete Agent?</h3>
        <p class="text-sm text-gray-600 mb-6">Are you sure you want to delete this agent? This action cannot be undone.</p>

        <div class="flex justify-end gap-3">
            <button onclick="closeDeleteModal()"
                    class="px-4 py-2 text-sm bg-gray-200 rounded hover:bg-gray-300">
                Cancel
            </button>

            <form id="deleteForm" method="post" action="">
                <button type="submit"
                        class="btn-custom px-4 py-2 text-sm">
                    Delete
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    function openDeleteModal(agentId) {
        let modal = document.getElementById("deleteModal");
        let form = document.getElementById("deleteForm");

        form.action = `/agents/${agentId}/delete`;  // dynamically set delete URL
        modal.classList.remove("hidden");
    }

    function closeDeleteModal() {
        document.getElementById("deleteModal").classList.add("hidden");
    }
</script>


</body>
</html>
